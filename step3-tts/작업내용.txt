ì‘ì—…ë‚´ìš© ê¸°ë¡

ğŸ“‚ 1. var í´ë”ì— step3-tts í´ë” ìƒì„±
sudo mkdir /var/step3-tts
sudo mkdir /var/step3-tts/kaggle-dataset

ğŸ‘¤ 2. gsi ê³„ì •ì—ê²Œ ì ‘ê·¼ ê¶Œí•œ ë¶€ì—¬
sudo chown gsi:gsi /var/step3-tts
sudo chmod 755 /var/step3-tts/kaggle-dataset


ğŸ“¦ 3. ë°ì´í„°ì…‹ ë³µì‚¬
sudo cp -r /home/gsi/kss-root/* /var/step3-tts/kaggle-dataset/
kaggle-dataset í´ë” ì•ˆì— kss-root í´ë”ê°€ ë“¤ì–´ê°€ëŠ” ê²Œ ì•„ë‹ˆë¼, 
kss-root ì•ˆì˜ ë‚´ìš©ë¬¼ë§Œ kaggle-datasetì— ì˜®ê¸°ê³  ì‹¶ë‹¤ë©´ ì´ë ‡ê²Œ


ğŸ 4. íŒŒì´ì¬ ê°€ìƒí™˜ê²½ ìƒì„± ë° í™œì„±í™”
python3.10 -m venv vits-env
source vits-env/bin/activate

5. pip ìµœì‹ í™” + ìºì‹œ ê²½ë¡œ ë³€ê²½
pip install --upgrade pip
export PIP_CACHE_DIR=/var/tmp


6. í•„ìˆ˜ íŒ¨í‚¤ì§€ ì„¤ì¹˜
sudo apt update
sudo apt install -y ffmpeg
pip install torch torchvision torchaudio --extra-index-url https://download.pytorch.org/whl/cu118
pip install numpy librosa phonemizer matplotlib tensorboard tqdm


7. VITS ì½”ë“œ ë‹¤ìš´ë¡œë“œ ë° requirements ì„¤ì¹˜
git clone https://github.com/jaywalnut310/vits.git
cd vits
pip install -r requirements.txt
ì„¤ì¹˜ì•ˆë˜ì„œ numpy==1.21.6 ë¡œ ìˆ˜ì •í›„ ë‹¤ì‹œ ì‹¤í–‰
ì„¤ì¹˜ ì˜¤ë¥˜ê°€ ë‚¨.. 
ì•„ë˜ì™€ ê°™ì´ ìˆ˜ì •í•˜ê³  ë‹¤ì‹œ ì§„í–‰

numpy==1.21.6
scipy==1.9.3
matplotlib==3.5.3
torch==2.1.2+cu118
torchaudio==2.1.2+cu118
librosa==0.10.1
phonemizer==3.2.1
tensorboard==2.14.0
tqdm==4.66.1

ì´ê±¸ í•´ë„ ì˜¤ë¥˜ê°€

requirements.txt ì—ì„œ torchë‘ torchaudio ì¤„ ë¹¼ê³ 

pip install torch==2.1.2+cu118 torchaudio==2.1.2+cu118 --extra-index-url https://download.pytorch.org/whl/cu118
pip install torchvision==0.16.2+cu118 --extra-index-url https://download.pytorch.org/whl/cu118
pip install -r requirements.txt

ì˜¤ë¥˜ê°€ ë‚˜ì„œ ë‹¤ì‹œ ì„¤ì¹˜

pip install contourpy==1.1.0

ì¢‹ì•„! ê·¸ëŸ¬ë©´ ì§€ê¸ˆ ìƒí™© ì •ë¦¬í•´ì„œ vits í”„ë¡œì íŠ¸ ê¸°ì¤€ìœ¼ë¡œ í˜¸í™˜ ì˜ ë§ëŠ” ë²„ì „ìœ¼ë¡œ requirements.txt ë‹¤ì‹œ ì§œì¤„ê²Œ.


ğŸ“¦ ì •ë¦¬ëœ requirements.txt
numpy==1.21.6
scipy==1.9.3
matplotlib==3.5.3
torch==2.1.2+cu118
torchaudio==2.1.2+cu118
torchvision==0.16.2+cu118
contourpy==1.1.0
phonemizer==3.2.1
librosa==0.10.1
llvmlite==0.41.1
numba==0.58.0
tensorboard==2.14.0
tqdm==4.66.1
cachetools==5.5.2
google-auth==2.39.0
google-auth-oauthlib==1.0.0
oauthlib==3.2.2
pyasn1==0.6.1
pyasn1-modules==0.4.2
requests-oauthlib==2.0.0
rsa==4.9.1
wheel==0.45.1
ğŸ“Œ ì„¤ì¹˜ ëª…ë ¹
ì´ íŒŒì¼ë¡œ requirements.txt ì €ì¥í•˜ê³  ì•„ë˜ ëª…ë ¹ì–´ ì‹¤í–‰:

pip install -r requirements.txt --extra-index-url https://download.pytorch.org/whl/cu118
â€» cu118 ì „ìš© íŒ¨í‚¤ì§€(torch/torchaudio/torchvision)ëŠ” --extra-index-url ì˜µì…˜ìœ¼ë¡œ ê°™ì´ ì„¤ì¹˜ ê°€ëŠ¥í•´.

8. convert_kss_to_vits_transcript.py íŒŒì¼ ìƒì„±
í•´ë‹¹ í´ë”ì˜ ë‚´ìš©ë“¤ì„ í™•ì¸í›„
```
1_0000.wav|ê·¸ëŠ” ê´œì°®ì€ ì²™í•˜ë ¤ê³  ì• ì“°ëŠ” ê²ƒ ê°™ì•˜ë‹¤.|
```
ì´ëŸ° í˜•íƒœë¡œ 2ê°œë§Œ ê°€ëŠ¥í•˜ê²Œ ì²˜ë¦¬í•´ì„œ transcript.txt ë¥¼ ë§Œë“ ë‹¤.
ê·¸ë¦¬ê³  wav íŒŒì¼ë„ ëª½ë•… ë‹¤ í•©ì³ì„œ outputì— ë³µì‚¬ë˜ë„ë¡ ë§Œë“¤ì—ˆë‹¤.


9. config.json ìƒì„±
```
/var/step3-tts/checkpoints	ëª¨ë¸ ì²´í¬í¬ì¸íŠ¸ ì €ì¥ ê²½ë¡œ (G_10000.pth ë“±)
/var/step3-tts/logs	í•™ìŠµ ë¡œê·¸, TensorBoard ë¡œê·¸ ì €ì¥ ê²½ë¡œ
/var/step3-tts/output	í•™ìŠµ ì¤‘ê°„ ê²°ê³¼ë¬¼ ì¶œë ¥ (ìƒ˜í”Œ wav ë“±)
/var/step3-tts/kaggle-dataset/kss	KSS wav íŒŒì¼ í´ë”
/var/step3-tts/transcript.txt	ì´ë¯¸ ìƒì„±í•œ í•™ìŠµìš© í…ìŠ¤íŠ¸ ëª©ë¡

sudo mkdir -p /var/step3-tts/checkpoints
sudo mkdir -p /var/step3-tts/logs
sudo mkdir -p /var/step3-tts/output

sudo chown -R gsi:gsi /var/step3-tts

python3 ./vits/train.py --config /var/step3-tts/config.json --model vits

```

```
{
    "train_config": {
      "batch_size": 32,                      // ë°°ì¹˜ í¬ê¸° (RTX 3090ì— ì í•©í•˜ê²Œ 32ë¡œ ì„¤ì •)
      "learning_rate": 0.0001,               // í•™ìŠµë¥ 
      "lr_decay_rate": 0.999,                // í•™ìŠµë¥  ê°ì†Œ ë¹„ìœ¨
      "lr_decay_steps": 50000,               // í•™ìŠµë¥  ê°ì†Œ ìŠ¤í…
      "max_epoch": 1000,                     // í•™ìŠµ ìµœëŒ€ epoch ìˆ˜
      "steps_per_checkpoint": 1000,          // ì²´í¬í¬ì¸íŠ¸ ì €ì¥ ì£¼ê¸° (step ë‹¨ìœ„)
      "checkpoint_dir": "/var/step3-tts/checkpoints", // ì²´í¬í¬ì¸íŠ¸ ì €ì¥ ë””ë ‰í† ë¦¬
      "log_dir": "/var/step3-tts/logs",            // ë¡œê·¸ ë””ë ‰í† ë¦¬
      "sample_rate": 22050,                  // ìƒ˜í”Œë§ ì£¼íŒŒìˆ˜ (KSSëŠ” 22050 Hz)
      "num_mels": 80,                        // Mel spectrogramì˜ ì£¼íŒŒìˆ˜ ìˆ˜
      "num_freq": 1025,                      // FFT í¬ê¸°
      "hop_size": 256,                       // hop í¬ê¸° (ê¸¸ì´)
      "win_size": 1024,                      // ìœˆë„ìš° í¬ê¸° (FFT ê¸¸ì´)
      "frame_shift_ms": 12.5,                // ì‹œê°„ ê°„ê²©
      "preemphasis": 0.97,                   // ì „ì²˜ë¦¬ì—ì„œì˜ ê°•ì¡° ë¹„ìœ¨
      "max_db": 100,                         // ìµœëŒ“ê°’ dB
      "min_db": -100,                        // ìµœì†Ÿê°’ dB
      "ref_level_db": 20,                    // ì°¸ì¡° ë ˆë²¨ dB
      "n_fft": 2048,                         // FFT í¬ê¸°
      "hop_length": 256,                     // Hop ê¸¸ì´
      "win_length": 1024,                    // ìœˆë„ìš° ê¸¸ì´
      "use_cuda": true,                      // CUDA ì‚¬ìš© ì—¬ë¶€
      "cuda_device": 0                       // ì‚¬ìš©í•  GPU (0ë²ˆì€ ì²« ë²ˆì§¸ GPU)
    },
    "data_config": {
      "text_cleaners": ["korean_cleaners"], // í•œê¸€ í…ìŠ¤íŠ¸ ì •ë¦¬ê¸°ë¥¼ ì‚¬ìš©í•  ê²ƒ
      "input_texts_file": "/var/step3-tts/transcript.txt", // transcript.txt ê²½ë¡œ
      "audio_dir": "/var/step3-tts/kaggle-dataset/kss",          // KSS ì˜¤ë””ì˜¤ íŒŒì¼ ê²½ë¡œ
      "train_output_dir": "/var/step3-tts/output"        // í•™ìŠµ í›„ ê²°ê³¼ë¬¼ ì €ì¥ ê²½ë¡œ
    },
    "model_config": {
      "encoder_hidden_size": 256,           // ì¸ì½”ë” íˆë“  ë ˆì´ì–´ í¬ê¸°
      "decoder_hidden_size": 256,           // ë””ì½”ë” íˆë“  ë ˆì´ì–´ í¬ê¸°
      "num_layers": 3,                      // ë„¤íŠ¸ì›Œí¬ ì¸µ ìˆ˜
      "embedding_size": 256,                // í…ìŠ¤íŠ¸ ì„ë² ë”© í¬ê¸°
      "attention_type": "multihead",        // ì–´í…ì…˜ íƒ€ì… (multihead ì¶”ì²œ)
      "dropout": 0.1                        // ë“œë¡­ì•„ì›ƒ ë¹„ìœ¨
    },
    "inference_config": {
      "use_mel": true,                      // ë©œ ìŠ¤í™íŠ¸ë¡œê·¸ë¨ ì‚¬ìš© ì—¬ë¶€
      "synthesis_mode": "fast",              // í•©ì„± ëª¨ë“œ ('fast' or 'accurate')
      "pretrained_model_path": "/path/to/pretrained/model"  // ë¯¸ë¦¬ í•™ìŠµëœ ëª¨ë¸ ê²½ë¡œ
    }
  }
  
```

