ì‘ì—…ë‚´ìš© ê¸°ë¡

ğŸ“‚ 1. var í´ë”ì— step3-tts í´ë” ìƒì„±
sudo mkdir /var/step3-tts
sudo mkdir /var/step3-tts/kss-dataset

ğŸ‘¤ 2. gsi ê³„ì •ì—ê²Œ ì ‘ê·¼ ê¶Œí•œ ë¶€ì—¬
sudo chown gsi:gsi /var/step3-tts
sudo chmod 755 /var/step3-tts/kss-dataset


ğŸ“¦ 3. ë°ì´í„°ì…‹ ë³µì‚¬
sudo cp -r /home/gsi/kss-root/* /var/step3-tts/kss-dataset/
kaggle-dataset í´ë” ì•ˆì— kss-root í´ë”ê°€ ë“¤ì–´ê°€ëŠ” ê²Œ ì•„ë‹ˆë¼, 
kss-root ì•ˆì˜ ë‚´ìš©ë¬¼ë§Œ kss-datasetì— ì˜®ê¸°ê³  ì‹¶ë‹¤ë©´ ì´ë ‡ê²Œ


ğŸ 4. íŒŒì´ì¬ ê°€ìƒí™˜ê²½ ìƒì„± ë° í™œì„±í™”
python3.10 -m venv vits-env
source vits-env/bin/activate

5. pip ìµœì‹ í™” + ìºì‹œ ê²½ë¡œ ë³€ê²½
pip install --upgrade pip
export PIP_CACHE_DIR=/var/tmp


6. í•„ìˆ˜ íŒ¨í‚¤ì§€ ì„¤ì¹˜
sudo apt update
sudo apt install -y ffmpeg
pip install torch torchvision torchaudio --extra-index-url https://download.pytorch.org/whl/cu118
pip install numpy librosa phonemizer matplotlib tensorboard tqdm


7. VITS ì½”ë“œ ë‹¤ìš´ë¡œë“œ ë° requirements ì„¤ì¹˜
git clone https://github.com/jaywalnut310/vits.git
cd vits

pip install -r requirements.txt
ì•„ë˜ì™€ ê°™ì´ ìˆ˜ì •í›„ ì§„í–‰
numpy==1.21.6
scipy==1.9.3
matplotlib==3.5.3
contourpy==1.1.0
phonemizer==3.2.1
librosa==0.10.1
llvmlite==0.41.1
numba==0.58.0
tensorboard==2.14.0
tqdm==4.66.1
cachetools==5.5.2
google-auth==2.39.0
google-auth-oauthlib==1.0.0
oauthlib==3.2.2
pyasn1==0.6.1
pyasn1-modules==0.4.2
requests-oauthlib==2.0.0
rsa==4.9.1
wheel==0.45.1

ğŸ“Œ ì„¤ì¹˜ ëª…ë ¹
ì´ íŒŒì¼ë¡œ requirements.txt ì €ì¥í•˜ê³  ì•„ë˜ ëª…ë ¹ì–´ ì‹¤í–‰:

pip install -r requirements.txt --extra-index-url https://download.pytorch.org/whl/cu118
â€» cu118 ì „ìš© íŒ¨í‚¤ì§€(torch/torchaudio/torchvision)ëŠ” --extra-index-url ì˜µì…˜ìœ¼ë¡œ ê°™ì´ ì„¤ì¹˜ ê°€ëŠ¥í•´.

8. wavíŒŒì¼ íŒ¨ë”© ë° ë¬¸ìì—´ í† í¬ë‚˜ì´ì € ì§„í–‰
```
# transscript.v.1.4.txt íŒŒì¼ í† í°í™” ë©”ë‰´ì–¼

1. transcript_conv.py ë¥¼ ì‚¬ìš©í•´ì„œ ìš°ì„  í•„ìš”í•œ í•­ëª© ì²«ë²ˆì§¸ì™€ 3ë²ˆì¬ë¥¼ ì¶”ì¶œí•´ì„œ ìƒˆë¡œìš´ íŒŒì¼ conv_transcript.v.1.4.txt ë¡œ ìƒì„±í•©ë‹ˆë‹¤.
2. tokenize_text.py ë¥¼ ì‚¬ìš©í•´ì„œ conv_transcript.v.1.4.txt íŒŒì¼ì˜ í•œê¸€ì„ í† í°í™” ì§„í–‰í•˜ê³  tokenized_transcript.v.1.4.txt ë¡œ ìƒì„±í•©ë‹ˆë‹¤.
3. token_test.py ë¥¼ ì‚¬ìš©í•´ì„œ í† í°í™”ëœ ë¶€ë¶„ë“¤ì´ ì •í™•í•˜ê²Œ ì¼ì¹˜í•˜ëŠ”ì§€ ê²€ì¦í•©ë‹ˆë‹¤.

# wav íŒŒì¼ ê¸¸ì´ ë™ì¼í•˜ê²Œ íŒ¨ë”©ì²˜ë¦¬

1. pad_wav_files.py ë¥¼ ì‚¬ìš©í•´ì„œ ì œì¼ ê¸´ íŒŒì¼ì„ ì°¾ì•„ë‚´ê³  í•´ë‹¹ ê¸¸ì´ì™€ ë™ì¼í•˜ê²Œ íŒ¨ë”©ì„ ì¶”ê°€í•´ì„œ ì €ì¥í•œë‹¤.

pip install numpy librosa soundfile tqdm
python pad_wav_files.py

```

9. config.json ìƒì„± ë° í•„ìš”í•œ í´ë” ì¶”ê°€

```
{
    "train_config": {
      "batch_size": 32,
      "learning_rate": 0.0001,
      "lr_decay_rate": 0.999,
      "lr_decay_steps": 50000,
      "max_epoch": 1000,
      "steps_per_checkpoint": 1000,
      "checkpoint_dir": "/var/step3-tts/checkpoints",
      "log_dir": "/var/step3-tts/logs",
      "sample_rate": 44100,
      "num_mels": 80,
      "num_freq": 1025,
      "hop_size": 256,
      "win_size": 1024,
      "frame_shift_ms": 12.5,
      "preemphasis": 0.97,
      "max_db": 100,
      "min_db": -100,
      "ref_level_db": 20,
      "n_fft": 2048,
      "hop_length": 256,
      "win_length": 1024,
      "use_cuda": true,
      "cuda_device": 0
    },
    "data_config": {
      "text_cleaners": ["korean_cleaners"],
      "input_texts_file": "/var/step3-tts/kss-dataset-conv/tokenized_transcript.v.1.4.txt",
      "audio_dir": "/var/step3-tts/kss-dataset-conv/kss",
      "train_output_dir": "/var/step3-tts/output"
    },
    "model_config": {
      "encoder_hidden_size": 256,
      "decoder_hidden_size": 256,
      "num_layers": 3,
      "embedding_size": 256,
      "attention_type": "multihead",
      "dropout": 0.1
    },
    "inference_config": {
      "use_mel": true,
      "synthesis_mode": "fast",
      "pretrained_model_path": "/path/to/pretrained/model"
    }
  }
  
```

```
/var/step3-tts/checkpoints	ëª¨ë¸ ì²´í¬í¬ì¸íŠ¸ ì €ì¥ ê²½ë¡œ (G_10000.pth ë“±)
/var/step3-tts/logs	í•™ìŠµ ë¡œê·¸, TensorBoard ë¡œê·¸ ì €ì¥ ê²½ë¡œ
/var/step3-tts/output	í•™ìŠµ ì¤‘ê°„ ê²°ê³¼ë¬¼ ì¶œë ¥ (ìƒ˜í”Œ wav ë“±)
/var/step3-tts/kss-dataset-conv/kss	KSS wav íŒŒì¼ í´ë”
/var/step3-tts/kss-dataset-conv/tokenized_transcript.v.1.4.txt	í…ìŠ¤íŠ¸

sudo mkdir -p /var/step3-tts/checkpoints
sudo mkdir -p /var/step3-tts/logs
sudo mkdir -p /var/step3-tts/output

sudo chown -R gsi:gsi /var/step3-tts
```

10. monotonic_align ì»´íŒŒì¼
```
cd /var/step3-tts/vits/monotonic_align

pip install cython

# ì»´íŒŒì¼ ì‹¤í–‰
python setup.py build_ext --inplace

# íŒŒì¼ ì´ë™
mv /var/step3-tts/vits/monotonic_align/monotonic_align/core.cpython-310-x86_64-linux-gnu.so \
   /var/step3-tts/vits/monotonic_align/
```

11. ë¹Œë“œ ë° ì‹¤í–‰
```
python3 ./vits/train.py --config /var/step3-tts/config.json --model vits

# í•„ìš”ì‹œ ì´ ë¶€ë¶„ë„ í•´ì•¼í•¨
pip install numpy==1.23.5
pip install unidecode
```

12. ì¶”ê°€ë¡œ ì½”ë“œ ìˆ˜ì •
```
vits/monotonic_align/__init__.py
#from .monotonic_align.core import maximum_path_c
from .core import maximum_path_c

vits/train.py
os.environ['MASTER_PORT'] = '50000'
```

# ë‹¤ì‹œ í•´ë´ì•¼ í•˜ëŠ” ë¶€ë¶„
- JSON ë¶€ë¶„ë„ ê³„ì¸µ í˜•íƒœë¡œ ë‹¤ì‹œ ë³€ê²½í•´ì„œ ì²˜ë¦¬í•˜ì.
- vits ë¶€ë¶„ë„ ìƒˆë¡œ ê°€ì ¸ì™€ì„œ ë‹¤ì‹œ ì¬êµ¬ì„±í•˜ì.
- ì†ŒìŠ¤ë¥¼ ëª‡ë²ˆ ë³´ë‹ˆ ì´í•´ê°€ ë˜ë„¤.. ë‹¤ì‹œ ìˆ˜ì •í•˜ê³  ë‹¤ì‹œ í•™ìŠµ í•˜ë„ë¡ í•˜ì.
- kss-conv ëŠ” ì´ë¯¸ ë§Œë“¤ì–´ì ¸ ìˆìœ¼ë‹ˆ ê·¸ ë¶€ë¶„ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ë©´ ëœë‹¤.
- ë‹¤ìŒ ìŠ¤í…ì„ í•˜ëŠ”ê±°ì•¼~~


ptë¥¼ ì§€ìš°ê³  ë‹¤ì‹œ ì‹œì‘í• ë•Œ
find /var/step3-tts/kss-conv -name "*.spec.pt" -delete

python3 ./vits/train.py --config /var/step3-tts/config.json --model vits


# ì´í›„ ì°¸ê³ í•œ ìë£Œë“¤
https://arca.live/b/aispeech/72903471
